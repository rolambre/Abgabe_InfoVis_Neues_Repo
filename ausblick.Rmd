---
title: "Ausblick"
#output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

### Im Ausblick findet ihr zunächst Informationen zum Grad der Unsicherheit im Verlauf des Impfgeschehens im internationalen Vergleich. Außerdem zeigen wir euch, wie sich der Ausbruch der Delta-Variante auf das Infektionsgeschehen auswirkt.

```{r include=FALSE}
library(tidyverse)
library(plotly)
library(dplyr)
library(colorspace)
library(ggthemes)
library(viridis)
library(viridisLite)
library(broom)
```


```{r message=FALSE, warning=FALSE, include=FALSE}
covid_data <- readr::read_csv('owid-covid-data.csv', guess_max = 25000)
unsicherheit_plot <- covid_data %>%
  filter(location %in% c("Germany", "China", "United States", "Ghana")) %>%
  select(continent, location, date, new_cases, new_vaccinations, new_deaths)

```


```{r message=FALSE, warning=FALSE, include=FALSE}
lm_data <- unsicherheit_plot %>% 
  nest(data = -c(location)) %>%
  mutate(
    fit = map(data, ~lm(new_cases ~ log(new_vaccinations), data = .x)),
    tidy_out = map(fit, tidy) 
  ) %>%
  unnest(cols = tidy_out) %>%
  select(-fit, -data) %>%
  filter(term != "(Intercept)")
lm_data
```

### Unsicherheiten im Verlauf des Infektions- und Impfgeschehens nach Kontinenten

```{r echo=FALSE, message=FALSE, warning=FALSE}

library(ggdist)
library(distributional) 

lm_data %>%
  #filter(date == "2021-07-06") %>%
  mutate(
    location = 
      fct_reorder(location, estimate) 
  ) %>%
  ggplot(aes(x = estimate, y = location)) +
  stat_dist_gradientinterval(
    aes(dist = dist_normal(
      mu = estimate, sigma = std.error
    )),
    point_size = 4,
    fill = "skyblue",
    quantiles = 20
  ) +
  xlab("Schätzwert") +
  ylab("Länder") +
  labs(title = "Schätzwert bezüglich des Impf- und Infektionsgeschehens ist je\nnach Land unterschiedlich",
              subtitle = "Schätzung bezüglich der Impfgeschehens nach verschiedenen Ländern",
              caption = "Dichte des Balkens zeigt den Grad der Unsicherheit an, Quelle: Our World in Data")

```

##### In diesem Diagramm haben wir den Schätzwert bezüglich des Verlaufs des Impf- und Infektionsgeschehens für euch visualsiert. Hierbei ist interessant zu sehen, wie sich die Unsicherheit in der Corona-Pandemieentwicklung nach Ländern aus verschiedenen Kontinenten unterscheidet. In Ghana und China scheint der Verlauf des Impfgeschehens, im Zusammenhang mit dem Infektionsgeschehen, sicher zu verlaufen. Im Gegensatz, ist der Verlauf in Deutschland und den USA relativ unsicher. Die ausgebleichten Balken um den Mittelwert zeigen an, dass in diesen Ländern der Verlauf der Impfquoten nicht sicher eingeschätzt werden kann. 

```{r message=FALSE, warning=FALSE, include=FALSE}
read.csv("Deltadaten.csv") -> Deltadaten

Deltadaten
```

##### Die Coronavirus-Pandemie ist in Deutschland und weltweit bei Weitem nicht überstanden. Aktuell sprechen Expert:innen vom Beginn einer vierten Infektionswelle in Deutschland, bisland ist mehr als Drittel der deutschen Bevölkerung nicht vollständig gemipft. 

##### Hinzu kommt, dass sich inzwischen insbesondere die Delta-Variante des Coronavirus in rasanter Geschwindigkeit ausbreitet. In Deutschland ist sie nun die am weitesten verbreitete Virus-Variante. Die Delta-Variante ist dabei noch deutlich ansteckender als die zuvor überwiegende Alpha-Variante. Im Diagramm seht ihr, wie sich die Anteile der jeweiligen Virus-Varianten seit Beginn der Pandemie entwickelt haben. Mit einem Klick auf die jeweilige Virus-Variante in der Legende könnt ihr diese im Diagramm ausblenden und euch so anschauen, wie sich die Virus-Varianten einzeln entwickelt haben. Wenn ihr über die verschiedenen Linien hovert, wird außerdem  der jeweilige Wert in der entsprechenden Kalenderwoche angezeigt.

```{r echo=FALSE, message=FALSE, warning=FALSE}
my_fun <- function(vec){ 
    as.numeric(vec[2]) / sum(Deltadaten$value[Deltadaten$Kalenderwoche==vec[1]]) *100 
}

#data$percentage <- apply(data , 1 , my_fun)

Deltadaten$Kalenderwoche <- as.numeric(Deltadaten$Kalenderwoche)

Deltadaten %>%
  select(Kalenderwoche, Anteil.Alpha, Anteil.Delta, Anteil.Beta, Anteil.Gamma) %>%
  pivot_longer(cols = c(Anteil.Alpha, Anteil.Delta, Anteil.Beta, Anteil.Gamma), names_to = "variante") %>%
group_by(Kalenderwoche, variante) %>%
                     summarise(value = sum(value)) -> Deltadaten2
  
Deltadaten2  %>%
  ggplot(aes(x = Kalenderwoche, y = value, group=variante, fill=variante)) +
    geom_area(alpha=0.6 , size=1, colour="black", position="stack") +
  scale_fill_viridis(option = "magma", discrete = T)+
  labs(y = "Prozent", fill="Kalenderwoche", title = "Neuinfektionen mit der Delta-Variante nehmen ab\nKalenderwoche 22 deutlich zu",
              subtitle = "Anteil Virusvarianten nach Kalenderwoche",
              caption = "Quelle: RKI") +
  #scale_y_continuous(labels = scales::percent) -> p
  scale_y_continuous(
    limits = c(0, 100),
    breaks = c(0, 25, 50, 75, 100),
    labels = c("0%", "25%", "50%", "75%", "100%")) -> p 


ggplotly(p)
  #facet_wrap(vars(type_of_case))
```

##### Noch unklar ist, inwiefern die Impfungen künftig vor der ansteckenderen Delta-Variante, aber auch vor anderen Virus-Varianten, schützen können. 
